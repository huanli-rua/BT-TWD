DATA:
  dataset_name: "adult"
  raw_path: "../data/adult/adult.data"
  target_col: "income"
  positive_label: ">50K"
  file_type: "csv"             # 让 loader 走 adult 专用分支
  use_kfold: true
  n_splits: 5
  shuffle: true
  stratify: true
  random_state: 42

PREPROCESS:
  continuous_cols:
    - "age"
    - "fnlwgt"
    - "education-num"
    - "capital-gain"
    - "capital-loss"
    - "hours-per-week"
  categorical_cols:
    - "workclass"
    - "education"
    - "marital-status"
    - "occupation"
    - "relationship"
    - "race"
    - "sex"
    - "native-country"
  handle_missing: "question_mark"
  fillna_strategy: "most_frequent"
  scale_continuous: true
  scaler_type: "standard"
  encoding_type: "onehot"
  drop_first: true
  save_feature_names: true

SCORE:
  bucket_score_mode: "f1_regret_bnd"   # 桶得分基于 F1 - λ1 * Regret - λ2 * BND_ratio，用于弱桶判定和增益计算，不控制分桶结构
  f1_weight: 1.0                       # F1 前的权重
  regret_weight: 1.0                   # Regret 的惩罚权重
  bnd_weight: 1.0                      # BND_ratio 的惩罚权重

BTTWD:
  bucket_levels:
    - level: 1
      name: "L1_age"
      type: "numeric_bin"
      col: "age"
      bins: [25, 35, 50]             # (-inf,25], (25,35], (35,50], (50,inf)
      labels: ["young", "mid", "old", "very_old"]

    - level: 2
      name: "L2_education"
      type: "categorical_group"
      col: "education"
      groups:
        low:  ["Preschool", "1st-4th", "5th-6th", "7th-8th"]
        mid:  ["9th", "10th", "11th", "12th", "HS-grad"]
        high: ["Assoc-acdm", "Assoc-voc", "Some-college", "Bachelors"]
        top:  ["Masters", "Doctorate", "Prof-school"]
      default_group: "unknown"       # 没在上面这些里的，统一归到 unknown

    - level: 3
      name: "L3_hours"
      type: "numeric_bin"
      col: "hours-per-week"
      # 示例分法：<35 = 低工时，35-45 = 标准工作，>45 = 加班型
      bins: [35, 45]
      labels: ["low_hours", "normal_hours", "high_hours"]
  min_bucket_size: 100              # 叶子桶最少样本数，分裂是否继续只由该值和 max_levels 决定
  max_levels: 3                     # 桶树最大层数，达到该层后不再细分（与 gain 无关）
  use_gain: true                    # 预留参数，目前代码中分桶不再依赖 gain，只在弱桶判定和回退统计中使用增益信息
  min_gain_for_split: -0.01         # 用于弱桶判定的增益阈值：增益 < 该值 的桶会被标记为弱桶，阈值回退到父桶/全局
  gamma_bucket: 0.000                # 多一个子桶的复杂度惩罚，类似 XGBoost 的 gamma
  bucket_subsample: 0.7             # 桶内样本随机采样比例（类似 XGBoost 的 subsample）
  max_train_samples_per_bucket: 20000 # 每个桶最多用于训练的样本数
  parent_share_rate: 0.2           # 预留参数，当前版本代码未使用父桶样本回流逻辑，仅作为以后扩展用
  min_parent_share: 50             # 预留参数，当前版本代码未使用父桶样本回流逻辑，仅作为以后扩展用
  val_ratio: 0.3                   # 只要桶内验证集样本数 >= min_val_samples_per_bucket，就会在该桶上单独搜阈值；否则标记为弱桶，阈值回退
  min_val_samples_per_bucket: 20   # 只要桶内验证集样本数 >= min_val_samples_per_bucket，就会在该桶上单独搜阈值；否则标记为弱桶，阈值回退
  use_global_backoff: true         # 若桶和父桶都没有模型时是否回退使用全局模型
  global_estimator: "xgb"          # 全局兜底模型类型：logreg/xgb/rf/knn/nb/none（缺省为logreg）
  bucket_estimator: "none"         # 桶内局部模型类型：logreg/xgb/rf/knn/nb/none（缺省为logreg）
  posterior_estimator: "logreg"    # 后验概率校准或二分类模型类型
  logreg_C: 1.0                    # 逻辑回归的正则化强度
  knn_k: 10                        # KNN 模型的邻居数
  bucket_rf:                       # 桶内随机森林参数
    n_estimators: 200
    max_depth: null
    random_state: 42
    n_jobs: -1
  bucket_xgb:                      # 桶内 XGBoost 模型参数（需安装 xgboost）
    n_estimators: 200
    max_depth: 3
    learning_rate: 0.1
    subsample: 0.8
    colsample_bytree: 0.8
    reg_lambda: 1.0
    random_state: 42
    n_jobs: -1
  global_xgb:                      # 全局 XGBoost 模型参数
    n_estimators: 300              # 迭代树数
    max_depth: 4                   # 树最大深度
    learning_rate: 0.1             # 学习率
    subsample: 0.8                 # 行采样比例
    colsample_bytree: 0.8          # 列采样比例
    reg_lambda: 1.0                # L2 正则项
    random_state: 42               # 随机种子
    n_jobs: -1                     # 并行线程数

THRESHOLDS:
  thresholds_mode: "bucket_wise"   # 阈值模式，目前只支持 bucket_wise；字段名要和代码中的 thresholds_mode 对应
  objective: "regret"              # 桶阈值搜索以 regret 为优化目标，F1/BND 会记录但不用于分桶结构或分裂决策
  alpha_grid: [0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]   # α 候选，grid 是全局统一的候选网格，桶级只在这个网格上做搜索
  beta_grid:  [0.0,0.1,0.2,0.3,0.4,0.5]    # β 候选
  gap_min: 0.05
  costs:
    C_TP: 0.0                              # 真正类成本
    C_TN: 0.0                              # 真负类成本
    C_FP: 0.75                              # 假正类成本（误报）
    C_FN: 1.5                             # 假负类成本（漏报）
    C_BP: 0.75                              # 边界-正成本
    C_BN: 0.25                              # 边界-负成本
  min_samples_for_thresholds: 100   # 一个桶触发单独阈值搜索所需要的最少验证样本数（不足则直接回退父桶/ROOT 阈值）


BASELINES:
  use_logreg: true
  use_random_forest: true
  use_knn: true
  use_xgboost: true

  common:
    threshold_mode: "fixed"
    fixed_threshold: 0.4
  logreg:
    C: 1.0
    max_iter: 500
    use_custom_threshold: true
    custom_threshold: 0.4
  random_forest:
    n_estimators: 200
    max_depth: null
    random_state: 42
    use_custom_threshold: true
    custom_threshold: 0.4

  knn:
    n_neighbors: 6
    use_custom_threshold: true
    custom_threshold: 0.4

  xgboost:
    n_estimators: 300
    max_depth: 4
    learning_rate: 0.1
    subsample: 0.8
    colsample_bytree: 0.8
    reg_lambda: 1.0
    random_state: 42
    n_jobs: -1
    use_custom_threshold: true
    custom_threshold: 0.4

EXP:
  kfold_repeats: 1
  n_jobs: -1
  verbose: 1

METRICS:
  use_metrics: ["Precision", "Recall", "F1", "BAC", "AUC", "MCC", "Kappa", "Regret"]
  pos_label: 1

OUTPUT:
  results_dir: "results/adult_bttwd"   # 结构 CSV 统一写到 results_dir 下，由 BTTWDModel 内部负责
  figs_dir: "figs"
  save_per_fold_metrics: true
  save_bucket_metrics: true
  save_config_copy: true
  save_threshold_logs: true
  threshold_log_filename: "bucket_thresholds_per_fold.csv"

SEED:
  global_seed: 42
